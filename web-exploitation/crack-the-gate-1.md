# CTF Write-up: Crack the Gate 1

**Category:** Web Exploitation
**Challenge Source:** picoCTF
**Write-up Author:** TitoDevsec (T1t0D3v$3c)

## Challenge Description
We were tasked with investigating a web portal believed to be hiding sensitive data. We were given an email (`ctf-player@picoctf.org`) but an unknown password. Normal login attempts failed, suggesting a logic flaw rather than a brute-force scenario.

**Target URL:** `http://amiable-citadel.picoctf.net:59247/`

## Vulnerability Analysis
### What was wrong?
The web application contained an **insecure debug backdoor** left in production. A developer comment in the HTML source code revealed a hidden HTTP header (`X-Dev-Access: yes`) that, when supplied, bypassed the authentication mechanism entirely. This is a critical **Authentication Bypass** vulnerability, falling under **OWASP A01: Broken Access Control**.

## Solution
1.  **Initial Reconnaissance:** Visiting the target URL revealed a simple login form. Intercepting a login attempt with Burp Suite showed a standard `POST /login` request with JSON data for email and password. As expected, brute-force attempts with common passwords failed, returning a `401 Unauthorized` response.

2.  **Source Code Review:** The key to solving this challenge was to inspect the HTML source code of the login page. A suspicious comment was discovered:

    ```html
    <!-- ABGR: Wnpx - grzcbenel olcnff: hfr urnqre "K-Qri-Npprff: lrf" -->
    <!-- Remove before pushing to production! -->
    ```

    The phrase "Remove before pushing to production!" strongly indicated a developer debug message or a backdoor.

3.  **Decode the Hidden Message:** The word `ABGR` hinted at a ROT13 cipher. Decoding the obfuscated message `Wnpx - grzcbenel olcnff: hfr urnqre "K-Qri-Npprff: lrf"` using ROT13 revealed:

    ```
    Jack - temporary bypass: use header "X-Dev-Access: yes"
    ```

    This was the critical piece of information: a temporary bypass mechanism using a custom HTTP header.

4.  **Exploitation:** The final step involved resending the login request with the newly discovered `X-Dev-Access: yes` header. The password field could be set to anything, as the header bypassed the authentication logic.

    ```http
    POST /login HTTP/1.1
    Host: amiable-citadel.picoctf.net:59247
    Content-Type: application/json
    X-Dev-Access: yes

    {"email":"ctf-player@picoctf.org","password":"anything"}
    ```

    The server responded with a `200 OK` status and a JSON payload containing the flag.

## Code Comparison

### Vulnerable Code (Insecure Debug Backdoor)
Leaving debug or administrative bypasses in production code, especially when triggered by client-controlled headers:

```javascript
// Server-side (Node.js/Express example)
app.post("/login", (req, res) => {
    // Insecure debug bypass
    if (req.headers["x-dev-access"] === "yes") {
        return res.json({ success: true, email: req.body.email, flag: process.env.FLAG });
    }

    // Normal authentication logic (which is now bypassed)
    const { email, password } = req.body;
    if (authenticateUser(email, password)) {
        return res.json({ success: true, email, flag: "" }); // Flag not exposed normally
    } else {
        return res.status(401).json({ success: false, message: "Unauthorized" });
    }
});
```

### Secure Code
All debug code, backdoors, and unadvertised features must be removed or conditionally compiled out before deployment to production environments. Authentication logic should be robust and solely rely on trusted server-side mechanisms.

```javascript
// Server-side (Secure Node.js/Express example)
app.post("/login", (req, res) => {
    // NO debug bypass in production

    const { email, password } = req.body;
    if (authenticateUser(email, password)) {
        // Only return necessary user info, never the flag directly
        return res.json({ success: true, email, firstName: "pico", lastName: "player" });
    } else {
        return res.status(401).json({ success: false, message: "Invalid credentials" });
    }
});

// In development, use environment variables or feature flags for debug access
// if (process.env.NODE_ENV === 'development' && req.headers['x-dev-access'] === 'yes') {
//     // ... debug logic ...
// }
```

## Lessons Learned
*   **Never Trust the Client:** Any input originating from the client, including HTTP headers, can be manipulated. Server-side logic must validate all inputs and never implicitly trust client-supplied data for security-critical decisions.
*   **Remove Debug Code:** Debug features, backdoors, and developer comments containing sensitive information must be thoroughly removed or disabled before deploying to production. They represent significant attack vectors.
*   **Source Code Review:** Always inspect the client-side source code (HTML, JavaScript) for hidden clues, comments, or obfuscated messages. These often contain hints about vulnerabilities.
*   **Encoding Recognition:** Familiarity with common encoding schemes (like ROT13, Base64) is crucial for deciphering hidden messages.
*   **Beyond Brute Force:** Not all authentication challenges require brute-forcing. A logical flaw or misconfiguration can often be a more effective path to bypass security.

## Flag
`picoCTF{brut4_f0rc4_0d39383f}`
